/* pkl-insn.def - Poke macro-assembler instructions.  */

/* Copyright (C) 2018 Jose E. Marchesi */

/* This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

/* This file contains the definition of the instructions known to the
   poke macro-assembler.

   PKL_DEF_INSN defines an instruction, or a macro-instruction.

   The first column is the code for the instruction.

   The second column is a string describing the instruction arguments.
   If the instruction takes no arguments, this should be the empty
   string.  Each argument is identified by a letter:

   `v' is for a pvm_val.
   `l' is for a label.
   `n' is for an immediate.
   `r' is for register.

   `a' is for a pkl_ast_node.
       This kind of arguments are only valid in macro-instructions.

   The third column is the instruction name, as defined in pvm.jitter.
   However, beware jitter's name mangling!

   Macros don't have instruction names.  */


/* Stack manipulation instructions.  */

PKL_DEF_INSN (PKL_INSN_PUSH, "v", "push")
PKL_DEF_INSN (PKL_INSN_DROP, "", "drop")
PKL_DEF_INSN (PKL_INSN_SWAP, "", "swap")
PKL_DEF_INSN (PKL_INSN_NIP, "", "nip")
PKL_DEF_INSN (PKL_INSN_DUP, "", "dup")
PKL_DEF_INSN (PKL_INSN_ROT, "", "rot")
PKL_DEF_INSN (PKL_INSN_NROT, "", "nrot")

/* Conversion instructions.  */

PKL_DEF_INSN (PKL_INSN_ITOI, "n", "itoi")
PKL_DEF_INSN (PKL_INSN_ITOIU, "n", "itoiu")
PKL_DEF_INSN (PKL_INSN_ITOL, "n", "itol")
PKL_DEF_INSN (PKL_INSN_ITOLU, "n", "itolu")

PKL_DEF_INSN (PKL_INSN_IUTOI, "n", "iutoi")
PKL_DEF_INSN (PKL_INSN_IUTOIU, "n", "iutoiu")
PKL_DEF_INSN (PKL_INSN_IUTOL, "n", "iutol")
PKL_DEF_INSN (PKL_INSN_IUTOLU, "n", "iutolu")

PKL_DEF_INSN (PKL_INSN_LTOI, "n", "ltoi")
PKL_DEF_INSN (PKL_INSN_LTOIU, "n", "ltoiu")
PKL_DEF_INSN (PKL_INSN_LTOL, "n", "ltol")
PKL_DEF_INSN (PKL_INSN_LTOLU, "n", "ltolu")

PKL_DEF_INSN (PKL_INSN_LUTOI, "n", "lutoi")
PKL_DEF_INSN (PKL_INSN_LUTOIU, "n", "lutoiu")
PKL_DEF_INSN (PKL_INSN_LUTOL, "n", "lutol")
PKL_DEF_INSN (PKL_INSN_LUTOLU, "n", "lutol")

/* Integer arithmetic instructions.  */

PKL_DEF_INSN (PKL_INSN_NEGI, "", "negi")
PKL_DEF_INSN (PKL_INSN_NEGIU, "", "negiu")
PKL_DEF_INSN (PKL_INSN_NEGL, "", "negl")
PKL_DEF_INSN (PKL_INSN_NEGLU, "", "neglu")
  
PKL_DEF_INSN (PKL_INSN_ADDI, "", "addi")
PKL_DEF_INSN (PKL_INSN_ADDIU, "", "addiu")
PKL_DEF_INSN (PKL_INSN_ADDL, "", "addl")
PKL_DEF_INSN (PKL_INSN_ADDLU, "", "addlu")

PKL_DEF_INSN (PKL_INSN_SUBI, "", "subi")
PKL_DEF_INSN (PKL_INSN_SUBIU, "", "subiu")
PKL_DEF_INSN (PKL_INSN_SUBL, "", "subl")
PKL_DEF_INSN (PKL_INSN_SUBLU, "", "sublu")

PKL_DEF_INSN (PKL_INSN_MULI, "", "muli")
PKL_DEF_INSN (PKL_INSN_MULIU, "", "muliu")
PKL_DEF_INSN (PKL_INSN_MULL, "", "mull")
PKL_DEF_INSN (PKL_INSN_MULLU, "", "mullu")

PKL_DEF_INSN (PKL_INSN_DIVI, "", "divi")
PKL_DEF_INSN (PKL_INSN_DIVIU, "", "diviu")
PKL_DEF_INSN (PKL_INSN_DIVL, "", "divl")
PKL_DEF_INSN (PKL_INSN_DIVLU, "", "divlu")

PKL_DEF_INSN (PKL_INSN_MODI, "", "modi")
PKL_DEF_INSN (PKL_INSN_MODIU, "", "modiu")
PKL_DEF_INSN (PKL_INSN_MODL, "", "modl")
PKL_DEF_INSN (PKL_INSN_MODLU, "", "modlu")

/* Shift instructions.  */

PKL_DEF_INSN (PKL_INSN_SLI, "", "bsli")
PKL_DEF_INSN (PKL_INSN_SLIU, "", "bsliu")
PKL_DEF_INSN (PKL_INSN_SLL, "", "bsll")
PKL_DEF_INSN (PKL_INSN_SLLU, "", "bsllu")

PKL_DEF_INSN (PKL_INSN_SRI, "", "bsri")
PKL_DEF_INSN (PKL_INSN_SRIU, "", "bsriu")
PKL_DEF_INSN (PKL_INSN_SRL, "", "bsrl")
PKL_DEF_INSN (PKL_INSN_SRLU, "", "bsrlu")
  
/* Bitwise instructions.  */

PKL_DEF_INSN (PKL_INSN_BNOTI, "", "bnoti")
PKL_DEF_INSN (PKL_INSN_BNOTIU, "", "bnotiu")
PKL_DEF_INSN (PKL_INSN_BNOTL, "", "bnotl")
PKL_DEF_INSN (PKL_INSN_BNOTLU, "", "bnotlu")

PKL_DEF_INSN (PKL_INSN_BANDI, "", "bandi")
PKL_DEF_INSN (PKL_INSN_BANDIU, "", "bandiu")
PKL_DEF_INSN (PKL_INSN_BANDL, "", "bandl")
PKL_DEF_INSN (PKL_INSN_BANDLU, "", "bandlu")

PKL_DEF_INSN (PKL_INSN_BORI, "", "bori")
PKL_DEF_INSN (PKL_INSN_BORIU, "", "boriu")
PKL_DEF_INSN (PKL_INSN_BORL, "", "borl")
PKL_DEF_INSN (PKL_INSN_BORLU, "", "borlu")

PKL_DEF_INSN (PKL_INSN_BXORI, "", "bxori")
PKL_DEF_INSN (PKL_INSN_BXORIU, "", "bxoriu")
PKL_DEF_INSN (PKL_INSN_BXORL, "", "bxorl")
PKL_DEF_INSN (PKL_INSN_BXORLU, "", "bxorlu")

/* Relational instructions.  */

PKL_DEF_INSN (PKL_INSN_AND, "", "and")
PKL_DEF_INSN (PKL_INSN_OR, "", "or")
PKL_DEF_INSN (PKL_INSN_NOT, "", "not")
  
/* Comparison instructions.  */

PKL_DEF_INSN (PKL_INSN_EQI, "", "eqi")
PKL_DEF_INSN (PKL_INSN_EQIU, "", "eqiu")
PKL_DEF_INSN (PKL_INSN_EQL, "", "eql")
PKL_DEF_INSN (PKL_INSN_EQLU, "", "eqlu")

PKL_DEF_INSN (PKL_INSN_NEI, "", "nei")
PKL_DEF_INSN (PKL_INSN_NEIU, "", "neiu")
PKL_DEF_INSN (PKL_INSN_NEL, "", "nel")
PKL_DEF_INSN (PKL_INSN_NELU, "", "nelu")

PKL_DEF_INSN (PKL_INSN_EQS, "", "eqs")
PKL_DEF_INSN (PKL_INSN_NES, "", "nes")

PKL_DEF_INSN (PKL_INSN_LTI, "", "lti")
PKL_DEF_INSN (PKL_INSN_LTIU, "", "ltiu")
PKL_DEF_INSN (PKL_INSN_LTL, "", "ltl")
PKL_DEF_INSN (PKL_INSN_LTLU, "", "ltlu")

PKL_DEF_INSN (PKL_INSN_LEI, "", "lei")
PKL_DEF_INSN (PKL_INSN_LEIU, "", "leiu")
PKL_DEF_INSN (PKL_INSN_LEL, "", "lel")
PKL_DEF_INSN (PKL_INSN_LELU, "", "lelu")

PKL_DEF_INSN (PKL_INSN_GTI, "", "gti")
PKL_DEF_INSN (PKL_INSN_GTIU, "", "gtiu")
PKL_DEF_INSN (PKL_INSN_GTL, "", "gtl")
PKL_DEF_INSN (PKL_INSN_GTLU, "", "gtlu")

PKL_DEF_INSN (PKL_INSN_GEI, "", "gei")
PKL_DEF_INSN (PKL_INSN_GEIU, "", "geiu")
PKL_DEF_INSN (PKL_INSN_GEL, "", "gel")
PKL_DEF_INSN (PKL_INSN_GELU, "", "gelu")

PKL_DEF_INSN (PKL_INSN_LTS, "", "lts")
PKL_DEF_INSN (PKL_INSN_GTS, "", "gts")
PKL_DEF_INSN (PKL_INSN_GES, "", "ges")
PKL_DEF_INSN (PKL_INSN_LES, "", "les")

/* String related instructions.  */

PKL_DEF_INSN (PKL_INSN_SCONC, "", "sconc")

/* Offset related instructions.  */

PKL_DEF_INSN (PKL_INSN_MKO, "", "mko")
PKL_DEF_INSN (PKL_INSN_OGETM, "", "ogetm")
PKL_DEF_INSN (PKL_INSN_OGETU, "", "ogetu")
PKL_DEF_INSN (PKL_INSN_OGETBT, "", "ogetbt")

/* Array related instructions.  */

PKL_DEF_INSN (PKL_INSN_MKA, "", "mka")
PKL_DEF_INSN (PKL_INSN_AREF, "", "aref")

/* Struct related instructions.  */

PKL_DEF_INSN (PKL_INSN_MKSCT, "", "mksct")
PKL_DEF_INSN (PKL_INSN_SREF, "", "sref")

/* Type related instructions.  */

PKL_DEF_INSN (PKL_INSN_MKTYI, "", "mktyi")
PKL_DEF_INSN (PKL_INSN_MKTYS, "", "mktys")
PKL_DEF_INSN (PKL_INSN_MKTYO, "", "mktyo")
PKL_DEF_INSN (PKL_INSN_MKTYSCT, "", "mktysct")

PKL_DEF_INSN (PKL_INSN_MKTYA, "", "mktya")
PKL_DEF_INSN (PKL_INSN_TYAGETN, "", "tyagetn")
PKL_DEF_INSN (PKL_INSN_TYAGETT, "", "tyagett")

PKL_DEF_INSN (PKL_INSN_TYPOF, "", "typof")

/* Branch instructions.  */

PKL_DEF_INSN (PKL_INSN_BA, "l", "ba")

PKL_DEF_INSN (PKL_INSN_BZI, "l", "bzi")
PKL_DEF_INSN (PKL_INSN_BZIU, "l", "bziu")
PKL_DEF_INSN (PKL_INSN_BZL, "l", "bzl")
PKL_DEF_INSN (PKL_INSN_BZLU, "l", "bzlu")

PKL_DEF_INSN (PKL_INSN_BNZI, "l", "bnzi")
PKL_DEF_INSN (PKL_INSN_BNZIU, "l", "bnziu")
PKL_DEF_INSN (PKL_INSN_BNZL, "l", "bnzl")
PKL_DEF_INSN (PKL_INSN_BNZLU, "l", "bnzlu")

/* IO instructions.  */

PKL_DEF_INSN (PKL_INSN_PEEKI, "n", "peeki")
PKL_DEF_INSN (PKL_INSN_PEEKIU, "n", "peekiu")
PKL_DEF_INSN (PKL_INSN_PEEKL, "n", "peekl")
PKL_DEF_INSN (PKL_INSN_PEEKLU, "n", "peeklu")
PKL_DEF_INSN (PKL_INSN_PEEKS, "", "peeks")

/* Miscellaneous instructions.  */

PKL_DEF_INSN (PKL_INSN_NOP, "v", "nop")
PKL_DEF_INSN (PKL_INSN_NOTE, "v", "note")
PKL_DEF_INSN (PKL_INSN_SIZ, "", "siz")

/* The only purpose of PKL_INSN_MACRO is to mark the beginning of
   macro instructions, and it should not be assembled.  */
PKL_DEF_INSN (PKL_INSN_MACRO, "", "")

PKL_DEF_INSN (PKL_INSN_NTON, "aa", "")
PKL_DEF_INSN (PKL_INSN_OGETMC, "a", "")

PKL_DEF_INSN (PKL_INSN_NEG, "a", "")
PKL_DEF_INSN (PKL_INSN_ADD, "a", "")
PKL_DEF_INSN (PKL_INSN_SUB, "a", "")
PKL_DEF_INSN (PKL_INSN_MUL, "a", "")
PKL_DEF_INSN (PKL_INSN_DIV, "a", "")
PKL_DEF_INSN (PKL_INSN_MOD, "a", "")
PKL_DEF_INSN (PKL_INSN_PEEK, "a", "")
PKL_DEF_INSN (PKL_INSN_BZ, "al", "")
PKL_DEF_INSN (PKL_INSN_BNZ, "al", "")

PKL_DEF_INSN (PKL_INSN_EQ, "a", "")
PKL_DEF_INSN (PKL_INSN_NE, "a", "")
PKL_DEF_INSN (PKL_INSN_LT, "a", "")
PKL_DEF_INSN (PKL_INSN_GT, "a", "")
PKL_DEF_INSN (PKL_INSN_GE, "a", "")
PKL_DEF_INSN (PKL_INSN_LE, "a", "")

PKL_DEF_INSN (PKL_INSN_SL, "a", "")
PKL_DEF_INSN (PKL_INSN_SR, "a", "")

PKL_DEF_INSN (PKL_INSN_BNOT, "a", "")
PKL_DEF_INSN (PKL_INSN_BAND, "a", "")
PKL_DEF_INSN (PKL_INSN_BOR, "a", "")
PKL_DEF_INSN (PKL_INSN_BXOR, "a", "")

/*
Local variables:
mode:c
End:
*/
